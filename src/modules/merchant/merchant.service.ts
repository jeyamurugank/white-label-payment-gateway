import { Injectable } from '@nestjs/common';import { PrismaService } from '../db/prisma.service';import * as crypto from 'crypto';@Injectable()export class MerchantService{constructor(private prisma:PrismaService){}async createMerchant(data){const slug=data.slug||data.name.toLowerCase().replace(/[^a-z0-9]+/g,'-');return this.prisma.merchant.create({data:{name:data.name,email:data.email,slug}});}async list(){return this.prisma.merchant.findMany();}async get(id){return this.prisma.merchant.findUnique({where:{id}});}async createApiKey(merchantId){const key='sk_'+crypto.randomBytes(20).toString('hex');await this.prisma.apiKey.create({data:{merchantId,key,revoked:false}});return key;}async revokeApiKey(key){return this.prisma.apiKey.updateMany({where:{key},data:{revoked:true}});} }